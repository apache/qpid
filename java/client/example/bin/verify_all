#!/bin/sh
# This script assumes QPID_SRC_HOME is set .

if [[ "x$QPID_SRC_HOME" =  "x" ]]; then
  echo "WARNING >>>  QPID_SRC_HOME needs to be set "  
  exit
fi

export CPP=$QPID_SRC_HOME/cpp/examples/examples
export PYTHON=$QPID_SRC_HOME/python/examples
export JAVA=$QPID_SRC_HOME/java/client/example/src/main/java/org/apache/qpid/example/jmsexample

run_broker(){
  $QPID_SRC_HOME/cpp/src/qpidd -d --no-data-dir
}

stop_broker(){
  $QPID_SRC_HOME/cpp/src/qpidd -q
}

QPID_LIBS=`find $QPID_SRC_HOME/java/build/lib -name '*.jar' | tr '\n' ":"`
export CLASSPATH=$QPID_LIBS:$CLASSPATH

verify=$QPID_SRC_HOME/cpp/examples/verify

for dir in $(find $JAVA/ -maxdepth 1 -type d -not -name '*.svn')
do
  for script in $(find $dir -maxdepth 1 -type f -name 'verify*' -not -name '*.*')
  do
    run_broker
    $verify $script
    stop_broker
  done
done
