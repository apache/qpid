<?xml version="1.0"?>
<project name="Apache.Qpid.Client" default="test">

    <target name="build">
        <csc target="library" 
             define="${build.defines}" 
             warnaserror="false" debug="${build.debug}" 
             output="${build.dir}/${project::get-name()}.Tests.dll">
            
            <sources>
                <include name="**/*.cs" />
            </sources>
            <references>
                <include name="${build.dir}/log4net.dll" />
                <include name="${build.dir}/nunit.framework.dll" />
                <include name="${build.dir}/${project::get-name()}.dll" />
                <include name="${build.dir}/Apache.Qpid.Common.dll" />
                <include name="${build.dir}/Apache.Qpid.Messaging.dll" />
                <include name="${build.dir}/Apache.Qpid.Sasl.dll" />
            </references>
        </csc>
        <copy tofile="${build.dir}/${project::get-name()}.Tests.dll.config" file="App.config" />
        <copy todir="${build.dir}" file="log4net.config"/>
    </target>

    <target name="test" depends="build">
        <nunit2 verbose="true">
            <formatter type="${nant.formatter}" usefile="false" />
            <test>
                <assemblies>
                    <include name="${build.dir}/${project::get-name()}.tests.dll"/>
                </assemblies>
                <categories>
                    <!-- The fail-over tests are interactive so should not be run as part of the build. -->
                    <exclude name="Integration"/>
                    <exclude name="SSL" if="${framework::get-target-framework() == 'mono-2.0'}"/>
                </categories>
            </test>
        </nunit2>
    </target>

</project>

